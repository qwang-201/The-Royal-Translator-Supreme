// EXPANDED DICTIONARY
const dictionary = {
    // Basic greetings
    "hello":"good morrow",
    "hi":"hail",
    "hey":"ho there",
    "goodbye":"fare thee well",
    "bye":"adieu",
    "farewell":"fare thee well",
    
    // Pronouns
    "you":"thou",
    "your":"thy",
    "yours":"thine",
    "yourself":"thyself",
    "you're":"thou art",
    "you've":"thou hast",
    "you'll":"thou wilt",
    
    // Verbs - to be
    "are":"art",
    "is":"'tis",
    "am":"am",
    "was":"wast",
    "were":"wert",
    "been":"been",
    "being":"being",
    
    // Verbs - to have
    "have":"hath",
    "has":"hath",
    "had":"hadst",
    "haven't":"hath not",
    "hasn't":"hath not",
    "hadn't":"hadst not",
    
    // Modal verbs
    "do":"dost",
    "does":"doth",
    "did":"didst",
    "don't":"dost not",
    "doesn't":"doth not",
    "didn't":"didst not",
    "will":"wilt",
    "won't":"wilt not",
    "shall":"shalt",
    "should":"shouldst",
    "would":"wouldst",
    "wouldn't":"wouldst not",
    "can":"canst",
    "can't":"canst not",
    "cannot":"canst not",
    "could":"couldst",
    "couldn't":"couldst not",
    "must":"must needs",
    "mustn't":"must needs not",
    "may":"mayst",
    "might":"mightst",
    
    // Common verbs
    "know":"knowest",
    "see":"behold",
    "look":"mark",
    "listen":"hark",
    "hear":"hearken",
    "speak":"quoth",
    "say":"sayeth",
    "tell":"tellest",
    "talk":"discourse",
    "ask":"beseech",
    "answer":"reply",
    "think":"bethink",
    "believe":"believeth",
    "understand":"comprehend",
    "want":"desire",
    "need":"require",
    "love":"fancy",
    "like":"fancy",
    "hate":"despise",
    "fear":"dread",
    "hope":"trust",
    "wish":"wouldst",
    "feel":"feelest",
    "seem":"seemeth",
    
    // Movement verbs
    "come":"hither",
    "go":"hence",
    "walk":"walkest",
    "run":"runneth",
    "stop":"cease",
    "stay":"tarry",
    "wait":"tarry",
    "leave":"depart",
    "arrive":"arrive",
    "return":"return",
    "follow":"follow",
    "lead":"lead",
    
    // Action verbs
    "make":"maketh",
    "take":"taketh",
    "give":"giveth",
    "get":"obtaineth",
    "put":"placeth",
    "bring":"bringeth",
    "keep":"keepeth",
    "hold":"holdeth",
    "help":"aid",
    "try":"endeavor",
    "work":"labor",
    "play":"sport",
    "fight":"battle",
    "kill":"slay",
    "die":"perish",
    "live":"dwell",
    "sleep":"slumber",
    "eat":"sup",
    "drink":"quaff",
    "write":"scribe",
    "read":"peruse",
    
    // Nouns - people
    "friend":"companion",
    "enemy":"foe",
    "stranger":"varlet",
    "girl":"wench",
    "boy":"lad",
    "man":"sirrah",
    "woman":"mistress",
    "lady":"maiden",
    "gentleman":"lord",
    "child":"babe",
    "baby":"infant",
    "person":"soul",
    "people":"folk",
    "family":"kin",
    "father":"father",
    "mother":"mother",
    "brother":"brother",
    "sister":"sister",
    "husband":"husband",
    "wife":"goodwife",
    "king":"monarch",
    "queen":"sovereign lady",
    
    // Nouns - places
    "here":"hither",
    "there":"thither",
    "where":"wherefore",
    "home":"abode",
    "house":"dwelling",
    "room":"chamber",
    "bathroom":"privy",
    "kitchen":"scullery",
    "bedroom":"bedchamber",
    "city":"metropolis",
    "town":"hamlet",
    "country":"realm",
    "world":"world",
    "heaven":"paradise",
    "hell":"perdition",
    
    // Nouns - things
    "thing":"matter",
    "stuff":"sundries",
    "food":"victuals",
    "drink":"libation",
    "money":"coin",
    "gold":"aureate",
    "clothes":"raiment",
    "dress":"gown",
    "shirt":"doublet",
    "pants":"breeches",
    "shoes":"boots",
    "hat":"cap",
    "sword":"blade",
    "book":"tome",
    "letter":"missive",
    "message":"dispatch",
    "news":"tidings",
    "story":"tale",
    "song":"ballad",
    "music":"minstrelsy",
    
    // Adjectives
    "good":"well",
    "bad":"ill",
    "great":"grand",
    "big":"mighty",
    "small":"wee",
    "happy":"merry",
    "sad":"melancholy",
    "angry":"wroth",
    "beautiful":"fair",
    "ugly":"foul",
    "pretty":"comely",
    "smart":"wise",
    "stupid":"foolish",
    "brave":"valiant",
    "afraid":"afeard",
    "old":"ancient",
    "young":"youthful",
    "new":"fresh",
    "true":"veritable",
    "false":"untrue",
    "real":"genuine",
    "fake":"counterfeit",
    
    // Adverbs
    "very":"most",
    "really":"verily",
    "truly":"forsooth",
    "always":"ever",
    "never":"ne'er",
    "often":"oft",
    "sometimes":"betimes",
    "now":"presently",
    "then":"anon",
    "soon":"anon",
    "later":"anon",
    "quickly":"swiftly",
    "slowly":"leisurely",
    "well":"well",
    "badly":"ill",
    
    // Question words
    "what":"what",
    "when":"when",
    "why":"wherefore",
    "how":"how",
    "who":"who",
    "which":"which",
    
    // Conjunctions and prepositions
    "and":"and",
    "but":"but",
    "or":"or",
    "if":"if",
    "because":"for",
    "before":"ere",
    "after":"after",
    "during":"whilst",
    "while":"whilst",
    "with":"with",
    "without":"sans",
    "about":"concerning",
    "of":"of",
    "from":"from",
    
    // Expressions
    "yes":"aye",
    "no":"nay",
    "ok":"aye",
    "okay":"very well",
    "please":"prithee",
    "thank you":"gramercy",
    "thanks":"gramercy",
    "sorry":"pardon",
    "excuse me":"prithee pardon",
    "maybe":"perchance",
    "perhaps":"mayhap",
    "indeed":"forsooth",
    "certainly":"certes",
    "probably":"belike",
    "of course":"marry",
    "wow":"marry",
    "oh":"marry",
    "ah":"alack",
    "ouch":"ow",
    "damn":"zounds",
    "god":"God",
    "lord":"lord"
};

// SHAKESPEAREAN PHRASES
const phrases = {
    light: [
        ". Methinks 'tis so",
        ". Verily",
        ". Indeed"
    ],
    medium: [
        ". Forsooth",
        ". By my troth",
        ". Marry",
        ". I'faith",
        ". In sooth"
    ],
    heavy: [
        ". Zounds, 'tis true",
        ". By the mass",
        ". Odds bodkins",
        ". By'r lady",
        ". God's wounds",
        ". Fie upon't"
    ]
};

// SHAKESPEAREAN INSULT COMPONENTS
const insultParts = {
    adjective1: ["artless", "bawdy", "beslubbering", "bootless", "churlish", "cockered", "clouted", "craven", "currish", "dankish", "dissembling", "droning", "errant", "fawning", "fobbing", "froward", "frothy", "gleeking", "goatish", "gorbellied", "impertinent", "infectious", "jarring", "loggerheaded", "lumpish", "mammering", "mangled", "mewling", "paunchy", "pribbling", "puking", "puny", "qualling", "rank", "reeky", "roguish", "ruttish", "saucy", "spleeny", "spongy", "surly", "tottering", "unmuzzled", "vain", "venomed", "villainous", "warped", "wayward", "weedy", "yeasty"],
    
    adjective2: ["base-court", "bat-fowling", "beef-witted", "beetle-headed", "boil-brained", "clapper-clawed", "clay-brained", "common-kissing", "crook-pated", "dismal-dreaming", "dizzy-eyed", "doghearted", "dread-bolted", "earth-vexing", "elf-skinned", "fat-kidneyed", "fen-sucked", "flap-mouthed", "fly-bitten", "folly-fallen", "fool-born", "full-gorged", "guts-griping", "half-faced", "hasty-witted", "hedge-born", "hell-hated", "idle-headed", "ill-breeding", "ill-nurtured", "knotty-pated", "milk-livered", "motley-minded", "onion-eyed", "plume-plucked", "pottle-deep", "pox-marked", "reeling-ripe", "rough-hewn", "rude-growing", "rump-fed", "shard-borne", "sheep-biting", "spur-galled", "swag-bellied", "tardy-gaited", "tickle-brained", "toad-spotted", "unchin-snouted", "weather-bitten"],
    
    noun: ["apple-john", "baggage", "barnacle", "bladder", "boar-pig", "bugbear", "bum-bailey", "canker-blossom", "clack-dish", "clotpole", "coxcomb", "codpiece", "death-token", "dewberry", "flap-dragon", "flax-wench", "flirt-gill", "foot-licker", "fustilarian", "giglet", "gudgeon", "haggard", "harpy", "hedge-pig", "horn-beast", "hugger-mugger", "joithead", "lewdster", "lout", "maggot-pie", "malt-worm", "mammet", "measle", "minnow", "miscreant", "moldwarp", "mumble-news", "nut-hook", "pigeon-egg", "pignut", "puttock", "pumpion", "ratsbane", "scut", "skainsmate", "strumpet", "varlot", "vassal", "whey-face", "wagtail"]
};

// SHAKESPEARE QUOTES
const quotes = [
    {text: "To be, or not to be, that is the question.", author: "Hamlet"},
    {text: "All the world's a stage, and all the men and women merely players.", author: "As You Like It"},
    {text: "The course of true love never did run smooth.", author: "A Midsummer Night's Dream"},
    {text: "This above all: to thine own self be true.", author: "Hamlet"},
    {text: "Though she be but little, she is fierce.", author: "A Midsummer Night's Dream"},
    {text: "What's in a name? That which we call a rose by any other name would smell as sweet.", author: "Romeo and Juliet"},
    {text: "We are such stuff as dreams are made on, and our little life is rounded with a sleep.", author: "The Tempest"},
    {text: "Cowards die many times before their deaths; the valiant never taste of death but once.", author: "Julius Caesar"},
    {text: "Love all, trust a few, do wrong to none.", author: "All's Well That Ends Well"},
    {text: "The fault, dear Brutus, is not in our stars, but in ourselves.", author: "Julius Caesar"},
    {text: "Some are born great, some achieve greatness, and some have greatness thrust upon them.", author: "Twelfth Night"},
    {text: "There is nothing either good or bad, but thinking makes it so.", author: "Hamlet"},
    {text: "Lord, what fools these mortals be!", author: "A Midsummer Night's Dream"},
    {text: "Brevity is the soul of wit.", author: "Hamlet"},
    {text: "If music be the food of love, play on.", author: "Twelfth Night"},
    {text: "Parting is such sweet sorrow.", author: "Romeo and Juliet"},
    {text: "Hell is empty and all the devils are here.", author: "The Tempest"},
    {text: "The better part of valour is discretion.", author: "Henry IV, Part 1"},
    {text: "Uneasy lies the head that wears a crown.", author: "Henry IV, Part 2"},
    {text: "Now is the winter of our discontent.", author: "Richard III"}
];

// ELEMENTS
const input = document.getElementById("modernInput");
const output = document.getElementById("oldOutput");
const flourishToggle = document.getElementById("flourishToggle");
const soundToggle = document.getElementById("soundToggle");
const intensitySlider = document.getElementById("intensitySlider");
const intensityLabel = document.getElementById("intensityLabel");
const directionSelect = document.getElementById("directionSelect");
const inputLabel = document.getElementById("inputLabel");
const outputLabel = document.getElementById("outputLabel");
const arrowIcon = document.getElementById("arrowIcon");

// CREATE REVERSE DICTIONARY
const reverseDictionary = {};
Object.keys(dictionary).forEach(modern => {
    const shakespearean = dictionary[modern];
    reverseDictionary[shakespearean] = modern;
});

// Add some additional reverse mappings for phrases
reverseDictionary["good morrow"] = "hello";
reverseDictionary["fare thee well"] = "goodbye";
reverseDictionary["thou art"] = "you are";
reverseDictionary["thou hast"] = "you have";
reverseDictionary["thou wilt"] = "you will";
reverseDictionary["dost not"] = "don't";
reverseDictionary["doth not"] = "doesn't";
reverseDictionary["didst not"] = "didn't";
reverseDictionary["wilt not"] = "won't";
reverseDictionary["wouldst not"] = "wouldn't";
reverseDictionary["canst not"] = "can't";
reverseDictionary["couldst not"] = "couldn't";
reverseDictionary["must needs"] = "must";
reverseDictionary["must needs not"] = "mustn't";
reverseDictionary["hath not"] = "haven't";
reverseDictionary["hadst not"] = "hadn't";

// STATE
let history = JSON.parse(localStorage.getItem('translationHistory')) || [];
let currentDirection = 'modern-to-old';

// UTILITY FUNCTIONS
function matchCase(original, replacement){
    if(original === original.toUpperCase())
        return replacement.toUpperCase();
    if(original[0] === original[0].toUpperCase())
        return replacement[0].toUpperCase()+replacement.slice(1);
    return replacement;
}

function getIntensity(){
    const val = parseInt(intensitySlider.value);
    return val === 1 ? 'light' : val === 2 ? 'medium' : 'heavy';
}

function playTypeSound(){
    if(soundToggle.checked){
        const audio = new Audio('data:audio/wav;base64,UklGRhwAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=');
        audio.volume = 0.1;
        audio.play().catch(()=>{});
    }
}

function countWords(text){
    return text.trim().split(/\s+/).filter(w => w.length > 0).length;
}

function updateStats(){
    const inputText = input.value;
    const outputText = output.value;
    
    document.getElementById('inputStats').textContent = 
        `Words: ${countWords(inputText)} | Characters: ${inputText.length}`;
    document.getElementById('outputStats').textContent = 
        `Words: ${countWords(outputText)} | Characters: ${outputText.length}`;
}

// TRANSLATION FUNCTION
function translate(text){
    if(!text.trim()) return '';
    
    if(currentDirection === 'old-to-modern'){
        return translateReverse(text);
    }
    
    const tokens = text.split(/(\b)/);
    const intensity = getIntensity();

    let converted = tokens.map(token=>{
        const lower = token.toLowerCase();
        if(dictionary[lower]){
            return matchCase(token, dictionary[lower]);
        }
        return token;
    }).join("");

    // Add flourishes based on intensity and toggle
    if(flourishToggle.checked){
        const selectedPhrases = phrases[intensity];
        
        if(intensity === 'light'){
            converted = converted.replace(/\.\s/g, () => {
                return Math.random() > 0.7 ? 
                    selectedPhrases[Math.floor(Math.random()*selectedPhrases.length)] + ". " : 
                    ". ";
            });
        } else if(intensity === 'medium'){
            converted = converted.replace(/\.\s/g, () => {
                return Math.random() > 0.5 ? 
                    selectedPhrases[Math.floor(Math.random()*selectedPhrases.length)] + ". " : 
                    ". ";
            });
        } else {
            converted = converted.replace(/\.\s/g, () => {
                return selectedPhrases[Math.floor(Math.random()*selectedPhrases.length)] + ". ";
            });
        }
        
        // Add occasional interjections
        if(intensity !== 'light' && Math.random() > 0.7){
            converted = "Hark! " + converted;
        }
    }

    return converted;
}

// REVERSE TRANSLATION FUNCTION (Shakespearean → Modern)
function translateReverse(text){
    if(!text.trim()) return '';
    
    let result = text;
    
    // Remove common Shakespearean flourishes first
    result = result.replace(/\bForsooth,?\s*/gi, '');
    result = result.replace(/\bBy my troth,?\s*/gi, '');
    result = result.replace(/\bMarry,?\s*/gi, '');
    result = result.replace(/\bI'faith,?\s*/gi, '');
    result = result.replace(/\bIn sooth,?\s*/gi, '');
    result = result.replace(/\bZounds,?\s*/gi, '');
    result = result.replace(/\bBy the mass,?\s*/gi, '');
    result = result.replace(/\bOdds bodkins,?\s*/gi, '');
    result = result.replace(/\bBy'r lady,?\s*/gi, '');
    result = result.replace(/\bGod's wounds,?\s*/gi, '');
    result = result.replace(/\bFie upon't,?\s*/gi, '');
    result = result.replace(/\bHark!\s*/gi, '');
    result = result.replace(/\bMethinks\s+/gi, 'I think ');
    result = result.replace(/\bVerily,?\s*/gi, '');
    result = result.replace(/\bIndeed,?\s*/gi, '');
    result = result.replace(/\b'tis\s+true\b/gi, 'it is true');
    
    // Multi-word phrases first (order matters - longer phrases first)
    const multiWordPhrases = {
        "good morrow": "hello",
        "fare thee well": "goodbye",
        "thou art": "you are",
        "thou hast": "you have",
        "thou wilt": "you will",
        "thou hadst": "you had",
        "thou dost": "you do",
        "thou doth": "you does",
        "thou didst": "you did",
        "thou shalt": "you shall",
        "thou shouldst": "you should",
        "thou wouldst": "you would",
        "thou canst": "you can",
        "thou couldst": "you could",
        "dost not": "don't",
        "doth not": "doesn't",
        "didst not": "didn't",
        "wilt not": "won't",
        "wouldst not": "wouldn't",
        "canst not": "can't",
        "couldst not": "couldn't",
        "must needs": "must",
        "hath not": "haven't",
        "hadst not": "hadn't"
    };
    
    // Replace multi-word phrases
    Object.keys(multiWordPhrases).forEach(oldPhrase => {
        const newPhrase = multiWordPhrases[oldPhrase];
        const regex = new RegExp('\\b' + oldPhrase + '\\b', 'gi');
        result = result.replace(regex, (match) => {
            return matchCase(match, newPhrase);
        });
    });
    
    // Then single words
    const tokens = result.split(/(\b)/);
    result = tokens.map(token=>{
        const lower = token.toLowerCase();
        if(reverseDictionary[lower]){
            return matchCase(token, reverseDictionary[lower]);
        }
        return token;
    }).join("");
    
    return result;
}

// DEBOUNCED TRANSLATION
let timer;
function debounceTranslate(){
    clearTimeout(timer);
    timer = setTimeout(()=>{
        output.value = translate(input.value);
        updateStats();
    }, 120);
}

// INSULT GENERATOR
function generateInsult(){
    const adj1 = insultParts.adjective1[Math.floor(Math.random()*insultParts.adjective1.length)];
    const adj2 = insultParts.adjective2[Math.floor(Math.random()*insultParts.adjective2.length)];
    const noun = insultParts.noun[Math.floor(Math.random()*insultParts.noun.length)];
    
    return `Thou ${adj1} ${adj2} ${noun}!`;
}

// HISTORY MANAGEMENT
function saveToHistory(){
    const modern = input.value.trim();
    const shakespearean = output.value.trim();
    
    if(!modern || !shakespearean) return;
    
    const entry = {
        modern,
        shakespearean,
        timestamp: new Date().toLocaleString()
    };
    
    history.unshift(entry);
    if(history.length > 20) history.pop();
    
    localStorage.setItem('translationHistory', JSON.stringify(history));
    renderHistory();
    
    alert('Translation saved to history!');
}

function renderHistory(){
    const panel = document.getElementById('historyPanel');
    
    if(history.length === 0){
        panel.innerHTML = '<p style="text-align:center;color:#666;font-family:\'Cinzel\', serif;">No translations saved yet.</p>';
        return;
    }
    
    panel.innerHTML = history.map((entry, index) => `
        <div class="history-item" onclick="loadHistoryItem(${index})">
            <strong>Modern:</strong> ${entry.modern.substring(0,100)}${entry.modern.length>100?'...':''}
            <br>
            <strong>Shakespearean:</strong> ${entry.shakespearean.substring(0,100)}${entry.shakespearean.length>100?'...':''}
            <small>${entry.timestamp}</small>
        </div>
    `).join('');
}

function loadHistoryItem(index){
    const entry = history[index];
    input.value = entry.modern;
    output.value = entry.shakespearean;
    updateStats();
    
    // Switch to translator tab
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    document.querySelector('[data-tab="translator"]').classList.add('active');
    document.getElementById('translator').classList.add('active');
}

function clearHistory(){
    if(confirm('Are you sure you want to clear all history?')){
        history = [];
        localStorage.removeItem('translationHistory');
        renderHistory();
    }
}

// QUOTES
function displayRandomQuote(){
    const quote = quotes[Math.floor(Math.random()*quotes.length)];
    document.getElementById('quoteText').textContent = `"${quote.text}"`;
    document.getElementById('quoteAuthor').textContent = `— ${quote.author}`;
}

// EVENT LISTENERS
input.addEventListener("input", () => {
    debounceTranslate();
    playTypeSound();
});

flourishToggle.addEventListener("change", debounceTranslate);

intensitySlider.addEventListener("input", (e) => {
    const intensity = getIntensity();
    intensityLabel.textContent = intensity.charAt(0).toUpperCase() + intensity.slice(1);
    debounceTranslate();
});

directionSelect.addEventListener("change", (e) => {
    currentDirection = e.target.value;
    updateDirectionUI();
    debounceTranslate();
});

function updateDirectionUI(){
    if(currentDirection === 'modern-to-old'){
        inputLabel.textContent = 'Modern Tongue';
        outputLabel.textContent = 'Shakespearean Script';
        arrowIcon.textContent = '→';
        input.placeholder = 'Type modern English here...';
        intensitySlider.parentElement.style.display = 'flex';
        flourishToggle.parentElement.style.display = 'block';
    } else {
        inputLabel.textContent = 'Shakespearean Script';
        outputLabel.textContent = 'Modern Tongue';
        arrowIcon.textContent = '←';
        input.placeholder = 'Type Shakespearean English here...';
        intensitySlider.parentElement.style.display = 'none';
        flourishToggle.parentElement.style.display = 'none';
    }
}

document.getElementById("copyBtn").onclick = () => {
    navigator.clipboard.writeText(output.value);
    alert('Translation copied to clipboard!');
};

document.getElementById("clearBtn").onclick = () => {
    input.value = "";
    output.value = "";
    updateStats();
    input.focus();
};

document.getElementById("swapBtn").onclick = () => {
    const temp = input.value;
    input.value = output.value;
    output.value = temp;
    updateStats();
    
    // Also swap direction
    currentDirection = currentDirection === 'modern-to-old' ? 'old-to-modern' : 'modern-to-old';
    directionSelect.value = currentDirection;
    updateDirectionUI();
    debounceTranslate();
};

document.getElementById("saveBtn").onclick = saveToHistory;

document.getElementById("generateInsult").onclick = () => {
    const insult = generateInsult();
    document.getElementById("insultDisplay").textContent = insult;
};

document.getElementById("copyInsult").onclick = () => {
    const insult = document.getElementById("insultDisplay").textContent;
    navigator.clipboard.writeText(insult);
    alert('Insult copied to clipboard!');
};

document.getElementById("newQuote").onclick = displayRandomQuote;

document.getElementById("clearHistory").onclick = clearHistory;

// TAB SWITCHING
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(target).classList.add('active');
        
        if(target === 'quotes'){
            displayRandomQuote();
        } else if(target === 'history'){
            renderHistory();
        }
    });
});

// INITIALIZE
updateDirectionUI();
updateStats();
displayRandomQuote();
renderHistory();

// Welcome message
setTimeout(() => {
    if(!input.value){
        input.placeholder = "Hark! Begin thy translation here...";
    }
}, 2000);